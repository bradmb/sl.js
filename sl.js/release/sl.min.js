var SLjs;(function(n){var t;(function(n){"use strict";n.ApiHost="https://slack.com/api/";n.PostMessage="chat.postMessage";n.WebSocketStart="rtm.start"})(t=n.Endpoints||(n.Endpoints={}))})(SLjs||(SLjs={})),function(n){var t;(function(t){"use strict";function i(t){var r=JSON.parse(t),u,i,f;switch(r.type){case"presence_change":u=r;n.Users[u.user].presence=u.presence;break;case"message":i=r;i.username!==undefined&&i.username===n.Config.visitorName?n.HtmlConstructor.AddChatMessage({icon_emoji:i.icons.image_64,text:i.text,username:"You"}):i.text.substr(0,n.VisitorId.length+1)==="!"+n.VisitorId&&(f=n.Users[i.user],n.HtmlConstructor.AddChatMessage({icon_emoji:f.image,text:i.text.replace("!"+n.VisitorId,""),username:f.name}))}}t.OnMessageReceived=i})(t=n.Events||(n.Events={}))}(SLjs||(SLjs={})),function(n){var t;(function(t){"use strict";var i=function(){function t(){}return t.prototype.IsDuringWorkHours=function(){var t,r,i,u;if(n.Config.workDates===undefined||n.Config.workDates===null)return!0;t=!0;r=new Date;switch(r.getDay()){case 0:t=n.Config.workDates.sunday!==undefined&&n.Config.workDates.sunday!==null&&n.Config.workDates.sunday;break;case 1:t=n.Config.workDates.monday!==undefined&&n.Config.workDates.monday!==null&&n.Config.workDates.monday;break;case 2:t=n.Config.workDates.tuesday!==undefined&&n.Config.workDates.tuesday!==null&&n.Config.workDates.tuesday;break;case 3:t=n.Config.workDates.wednesday!==undefined&&n.Config.workDates.wednesday!==null&&n.Config.workDates.wednesday;break;case 4:t=n.Config.workDates.thursday!==undefined&&n.Config.workDates.thursday!==null&&n.Config.workDates.thursday;break;case 5:t=n.Config.workDates.friday!==undefined&&n.Config.workDates.friday!==null&&n.Config.workDates.friday;break;case 6:t=n.Config.workDates.saturday!==undefined&&n.Config.workDates.saturday!==null&&n.Config.workDates.saturday}if(!t)return!1;if(i=r.getUTCHours(),n.Config.workDates.stopHourUtc<n.Config.workDates.startHourUtc){if(n.Config.workDates.startHourUtc<i&&n.Config.workDates.stopHourUtc>i)return!1}else if(n.Config.workDates.startHourUtc>i||n.Config.workDates.stopHourUtc<i)return!1;return(u=r.getMinutes(),n.Config.workDates.startHourUtc===i&&n.Config.workDates.startMinutes>=u)?!1:n.Config.workDates.stopHourUtc===i&&n.Config.workDates.stopMinutes<=u?!1:!0},t}();t.Validation=i})(t=n.Hours||(n.Hours={}))}(SLjs||(SLjs={})),function(n){var t;(function(t){"use strict";function i(t,i,r){var u=new XMLHttpRequest,o=[],f,e;for(f in t)t.hasOwnProperty(f)&&(f==="attachments"&&(t[f]=JSON.stringify(t[f])),o.push(encodeURIComponent(f)+"="+encodeURIComponent(t[f])));e=n.Endpoints.ApiHost+i+"?token="+n.Config.token+"&channel="+n.Config.channel+"&";e+=o.join("&");u.onreadystatechange=function(){r!=null&&r!==undefined&&u.readyState===4&&u.status===200&&r(u.responseText)};u.open("POST",e,!0);u.setRequestHeader("Content-Type","text/plain;charset=UTF-8");u.send()}t.Action=i})(t=n.Http||(n.Http={}))}(SLjs||(SLjs={})),function(n){var t;(function(t){"use strict";function c(t){var u,e,o;f!=null&&h();u=document.createElement("div");u.id=n.Parameters.INTERFACE_WRAPPER_DIV_ID;u.className="sljs-pos-"+n.Config.position;n.Config.position!=="float"&&(u.className+=" sljs-pos-side");f=t;f.appendChild(u);r=document.createElement("div");r.id=n.Parameters.INTERFACE_DIV_ID;u.appendChild(r);e=document.createElement("div");e.className="sljs-close-button";r.appendChild(e);o=document.createElement("button");o.innerText="x";o.onclick=function(){h()};e.appendChild(o);i=document.createElement("div");i.className="sljs-app-wrapper";r.appendChild(i)}function h(){e=[];u.remove();i.remove();r.remove();f.innerHTML="";f.cloneNode(!0);f=null;n.Config.visitorName=null;n.AppWebSocket.CloseWebSocket()}function l(t){var s,f,e,u,o;r.className="sljs-welcome";s=document.createElement("h2");s.innerHTML=n.Strings.WELCOME_MSG.replace("%APPNAME%",n.Strings.APP_NAME);i.appendChild(s);f=document.createElement("h3");f.innerText=n.Strings.NAME_REQUIRED;i.appendChild(f);e=document.createElement("div");e.className="sljs-welcome-input";i.appendChild(e);u=document.createElement("input");u.placeholder=n.Strings.NAME_INPUT_PLACEHOLDER;e.appendChild(u);e.onkeypress=function(i){if(i.charCode===13){if(u.value.trim()===""){f.className="sljs-validation-failed";f.innerText=n.Strings.NAME_INPUT_VALIDATION_ERROR;u.className="validation-failed";u.focus();return}t(u.value)}return!0};u.focus();o=document.createElement("button");o.innerText=n.Strings.NAME_INPUT_BUTTON;o.type="button";o.onclick=function(){if(u.value.trim()===""){f.className="sljs-validation-failed";f.innerText=n.Strings.NAME_INPUT_VALIDATION_ERROR;u.className="validation-failed";u.focus();return}t(u.value)};e.appendChild(o)}function a(){var t,f;r.className="sljs-chat";i.innerHTML="";u=document.createElement("div");u.className="sljs-chat-messages";i.appendChild(u);t=document.createElement("textarea");t.className="sljs-chat-message-input";t.placeholder=n.Strings.CHAT_INPUT_PLACEHOLDER;t.onkeypress=function(i){return i.charCode===13&&i.shiftKey?!0:i.charCode===13?(n.Messaging.SendMessage(t.value),t.value="",!1):!0};i.appendChild(t);t.focus();f=new n.Hours.Validation;f.IsDuringWorkHours()?(o=!1,s({text:n.Strings.CHAT_INITIAL_MSG.replace("%APPNAME%",n.Strings.APP_NAME),username:n.Strings.APP_NAME,icon_emoji:null,isImportantMessage:!0})):(o=!0,s({text:n.Strings.CHAT_AFTER_HOURS_MSG.replace("%APPNAME%",n.Strings.APP_NAME),username:n.Strings.APP_NAME,icon_emoji:null,isImportantMessage:!0,isErrorMessage:!0}))}function s(t){for(var i=n.Parameters.REGEX_URL_MATCH_QUERY.exec(t.text),r;i!=null;){if(i==null)return;r=document.createElement("a");r.href=i[1];r.text=i[1];r.target="_blank";t.text=t.text.replace(i[0],r.outerHTML);i=n.Parameters.REGEX_URL_MATCH_QUERY.exec(t.text)}t.username.length>1&&(t.username=t.username.charAt(0).toUpperCase()+t.username.slice(1),t.username.indexOf(" ")!==-1&&t.username!==n.Strings.APP_NAME&&(t.username=t.username.split(" ")[0]));t.text=t.text.replace("\n",document.createElement("br").outerHTML);t.username!=="You"&&o&&!t.isImportantMessage&&(o=!1,e.shift());e.push(t);v()}function v(){var r,t,i,f,o,s;for(u.innerHTML="",r=0;r<e.length;r++)t=e[r],i=document.createElement("div"),i.className="sljs-chat-item",t.isImportantMessage!==undefined&&t.isImportantMessage!==null&&(i.className+=" sljs-chat-item-important"),t.isErrorMessage!==undefined&&t.isErrorMessage!==null&&(i.className+=" sljs-chat-item-error"),u.appendChild(i),t.icon_emoji!=null&&(f=document.createElement("img"),f.className="sljs-chat-item-icon",f.src=t.icon_emoji,i.appendChild(f)),t.username!==n.Strings.APP_NAME&&(o=document.createElement("div"),o.className=t.username!=="You"?"sljs-chat-item-support":"sljs-chat-item-sender",o.innerText=t.username!=="You"?t.username+" @ "+n.Config.supportGroupName:t.username,i.appendChild(o)),s=document.createElement("div"),s.className="sljs-chat-item-body",s.innerHTML=t.text,i.appendChild(s);u.scrollTop=u.scrollHeight}var r,i,f=null,u,e=[],o;t.ConstructInterface=c;t.ConstructWelcomeWithName=l;t.ConstructConversationWindow=a;t.AddChatMessage=s})(t=n.HtmlConstructor||(n.HtmlConstructor={}))}(SLjs||(SLjs={})),function(n){var t;(function(t){"use strict";function i(t){if(!this.firstMessageSent){this.firstMessageSent=!0;r(t);return}var i={text:t,username:n.Config.visitorName,icon_emoji:n.Config.visitorIcon};n.Http.Action(i,n.Endpoints.PostMessage)}function r(t){var i=[],r;i.push({title:"",text:n.Strings.MESSAGE_REPLY_HINT.replace("%VISITORID%",n.VisitorId),color:n.Strings.ATTACHMENT_COLOR});r={attachments:i,text:t,username:n.Config.visitorName,icon_emoji:n.Config.visitorIcon};n.Http.Action(r,n.Endpoints.PostMessage)}t.SendMessage=i})(t=n.Messaging||(n.Messaging={}))}(SLjs||(SLjs={})),function(n){var t;(function(){"use strict"})(t=n.Models||(n.Models={}))}(SLjs||(SLjs={})),function(n){var t;(function(n){"use strict";n.REGEX_URL_MATCH_QUERY=/<([^><a]+)>/g;n.INTERFACE_DIV_ID="sljs-interface";n.INTERFACE_WRAPPER_DIV_ID="sljs-wrapper"})(t=n.Parameters||(n.Parameters={}))}(SLjs||(SLjs={})),function(n){"use strict";n.InterfaceWebSocket=null;var t=function(){function t(){}return t.prototype.GetWebSocketData=function(t){var i={mpim_aware:!1,no_unreads:!0,simple_latest:!0,token:n.Config.token};n.Http.Action(i,n.Endpoints.WebSocketStart,function(i){for(var r,f=JSON.parse(i),u=0,e=f.users;u<e.length;u++)r=e[u],n.Users[r.id]={name:r.real_name!==""?r.real_name:r.name,presence:r.presence,image:r.profile.image_72};t(f.url)})},t.prototype.ConnectWebSocket=function(t){n.InterfaceWebSocket=new WebSocket(t);n.InterfaceWebSocket.onopen=function(){};n.InterfaceWebSocket.onmessage=function(t){n.Events.OnMessageReceived(t.data)};n.InterfaceWebSocket.onerror=function(){};n.InterfaceWebSocket.onclose=function(){}},t.prototype.CloseWebSocket=function(){n.InterfaceWebSocket!==null&&(n.InterfaceWebSocket.close(),n.InterfaceWebSocket=null)},t}();n.Socket=t}(SLjs||(SLjs={})),function(n){var t;(function(n){"use strict";n.INTERNAL_APP_NAME="SL.js";n.INTERNAL_SUPPORT_GROUP_NAME="Support Team";n.APP_NAME=n.INTERNAL_APP_NAME;n.FIRST_MESSAGE_HEADER="First message for this visit to the channel";n.MESSAGE_REPLY_HINT="Reply to me using !%VISITORID% [message]";n.ATTACHMENT_COLOR="#D00000";n.VISITOR_ICON=":speech_balloon:";n.WELCOME_MSG="Welcome to the support channel for<br/>%APPNAME%!";n.NAME_REQUIRED="During our conversation, what can we call you?";n.NAME_INPUT_PLACEHOLDER="Enter your name in here";n.NAME_INPUT_VALIDATION_ERROR="Sorry, can you try entering your name in again?";n.NAME_INPUT_BUTTON="Continue";n.CHAT_INPUT_PLACEHOLDER="Enter your message here. Use SHIFT+ENTER to create a new line.";n.CHAT_AFTER_HOURS_MSG="Welcome to the support channel for %APPNAME%. It is currently outside of standard support hours, so please leave a message and we will get back to you during standard business hours.";n.CHAT_INITIAL_MSG="Welcome to the support channel for %APPNAME%. Please ask your question in this channel and someone will get back to you shortly."})(t=n.Strings||(n.Strings={}))}(SLjs||(SLjs={})),function(n){"use strict";var i,r,t;n.Users={};n.Config={applicationName:n.Strings.APP_NAME,channel:null,element:null,token:null,position:"float"};i=function(){function i(i,r){n.AppHandler=new t;n.AppHandler.mapConfigParameters(r);n.AppHandler.constructData();this.init(i)}return i.prototype.init=function(t){var i=document.getElementById(t);i.onclick=function(){n.AppHandler.constructInterface()}},i}();n.Button=i;r=function(){function i(i,r){n.AppHandler=new t;n.AppHandler.mapConfigParameters(r);n.AppHandler.constructData();this.init(i)}return i.prototype.init=function(){n.AppHandler.constructInterface()},i}();n.Interface=r;t=function(){function t(){}return t.prototype.constructInterface=function(){n.HtmlConstructor.ConstructInterface(document.getElementById(n.Config.element));n.Config.visitorName===null||n.Config.visitorName===undefined?n.HtmlConstructor.ConstructWelcomeWithName(function(t){n.Config.visitorName="["+n.VisitorId+"] "+t+" ("+n.Config.applicationName+")";n.HtmlConstructor.ConstructConversationWindow();n.AppWebSocket=new n.Socket;n.AppWebSocket.GetWebSocketData(function(t){n.AppWebSocket.ConnectWebSocket(t)})}):(n.Config.visitorName="["+n.VisitorId+"] "+n.Config.visitorName+" ("+n.Config.applicationName+")",n.HtmlConstructor.ConstructConversationWindow(),n.AppWebSocket=new n.Socket,n.AppWebSocket.GetWebSocketData(function(t){n.AppWebSocket.ConnectWebSocket(t)}))},t.prototype.constructData=function(){n.VisitorId=this.generateVisitorId();(n.Config.visitorIcon===null||n.Config.visitorIcon===undefined)&&(n.Config.visitorIcon=n.Strings.VISITOR_ICON);n.Config.applicationName===null||n.Config.applicationName===undefined?n.Config.applicationName=n.Strings.APP_NAME:n.Strings.APP_NAME=n.Config.applicationName;(n.Config.supportGroupName===null||n.Config.supportGroupName===undefined)&&(n.Config.supportGroupName=n.Strings.INTERNAL_SUPPORT_GROUP_NAME)},t.prototype.generateVisitorId=function(){var n=new Date;return n.getMilliseconds()+""+Math.floor(Math.random()*10+1)},t.prototype.mapConfigParameters=function(t){for(var i in t)t.hasOwnProperty(i)&&t[i]!==undefined&&(n.Config[i]=t[i])},t}();n.ApplicationHandler=t}(SLjs||(SLjs={}));